{% load static %}


<!DOCTYPE html>
<html lang="en">

<head>
    <link rel="stylesheet" href="{% static 'css/admin.css' %}">
    <link rel="stylesheet" href="{% static 'css/global.css' %}">
    <script src="{% static 'javascript/global.js' %}"></script>
    <script src="{% static 'javascript/category.js' %}"></script>


    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CampAid Supply Management System</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">

</head>

<body>
    {% include 'message.html' %}
    <!-- {% include 'menu.html' %} -->
    <header>
        <!-- Logo -->
        <div>
            <span>âœ¨ Admin Dashboard</span>
        </div>

        <!-- Navigation -->
        <nav>
            <a onclick="showSection('admin-dashboard')" class="nav-link">VolunteerHead</a>
            <a onclick="showSection('volunteer-interface')" class="nav-link">Manage-zone</a>
            <a onclick="showSection('supplier-portal')" class="nav-link">Item-Category</a>
        </nav>

        <!-- Notification Button -->
        <div class="notification-wrapper">
            <button id="notification-button">
                <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 32 32">
                    <path d="M16 2C8.28 2 2 7.8 2 14.93a12.144 12.144 0 001.696 6.15l-1.668 7.51A1.16 1.16 0 003.63 29.9l6.914-3.072A14.835 14.835 0 0016 27.861c7.72 0 14-5.8 14-12.93S23.72 2 16 2zm4.508 16.32h-9.016a1.16 1.16 0 010-2.32h9.016a1.16 1.16 0 010 2.32zm0-4.638h-9.016a1.16 1.16 0 010-2.318h9.016a1.16 1.16 0 110 2.318z" fill="currentColor"></path>
                </svg>
            </button>
        </div>

        <!-- User & Logout -->
        <div class="user-section">
            <a href="#">Log In</a>
            <div class="user-icon">ðŸ‘¤</div>
            <a href="{% url 'logout' %}" style="color: white;" class="logout-button">Logout</a>
        </div>
    </header>

    <script>
        document.getElementById('notification-button').addEventListener('click', function () {
            window.location.href = "{% url 'notification_detail' %}?type=Admin";
        });
    </script>

    <!-- Navigation to switch between sections -->
    <!-- <nav>
        <button onclick="showSection('admin-dashboard')">Manage-Volunteer-head</button>
        <button onclick="showSection('volunteer-interface')">Manage-zone</button>
        <button onclick="showSection('supplier-portal')">Manage item-category</button>
    </nav> -->

    <!-- Admin Dashboard Section -->
    <section id="admin-dashboard" style="display: block;">
        <h2>Volunteer-head</h2>

        <!-- Admin Registration Form -->
        <div id="admin-registration">
            <h3>Register volunteer-head</h3>
            <div class="div1">

                <label for="volunteer-head Name">volunteer-head Name</label>
                <input type="text" id="volunteer-head Name" placeholder="volunteer-head Name" name="volunteer-head Name"
                    required>

                <label for="volunteer-head Email">volunteer-head Email</label>
                <input type="email" id="volunteer-head Email" placeholder="volunteer-head Email"
                    name="volunteer-head Email" required>

                <label for="volunteer-head phone">volunteer-head phone</label>
                <input type="number" id="volunteer-head phone" placeholder="volunteer-head phone"
                    name="volunteer-head phone" required minlength="8">

                <button style="background-color: #4a6267;" onclick="Add_volunteer_head()">Register Admin</button>
            </div>

            <h3>Registered volunteer-head</h3>
            <table class="styled-table" id="table_body">
                <thead>
                    <tr>
                        <th>.No</th>
                        <th>volunteer-head Name</th>
                        <th>volunteer-head Email</th>
                        <th>volunteer-head phone</th>
                        <th>Action</th>
                        <th>Send Email</th>
                    </tr>
                </thead>
                <tbody id="table_body1">

                </tbody>
            </table>

        </div>

        <!-- Camp Registration Form -->


        </div>
    </section>

    <!-- Volunteer Interface Section -->
    <section id="volunteer-interface" style="display: none;">
        <h2>Manage-zone</h2>

        <!-- Combined Volunteer and Camp Registration Form -->
        <div id="volunteer-registration">
            <h3>Register zone</h3>
            <div class="div1">
                <label for="zone-name">zone Name</label>
                <input type="text" id="zone-name" placeholder="zone Name" name="zone-name" required>
                <input type="hidden" name="csrfmiddlewaretoken" value="{{ csrf_token }}">

                <label for="zone-description">zone description</label>
                <input type="text" id="zone-description" placeholder="zone description" name="zone-description"
                    required>

                <label for="volunteer-select">Select volunteer</label>
                <select id="volunteer-head3" required>
                    <option value="">Select a volunteerHead</option>
                </select>

                <button name="zone_submit" onclick="Add_zone()">Register zone</button>
            </div>
            <h3>Registered zone</h3>
            <table class="styled-table" id="zone-list">
                <thead>
                    <tr>
                        <th>.No</th>
                        <th>zone Name</th>
                        <th>zone description</th>
                        <th>zone Volunteershead </th>
                        <th>action</th>
                    </tr>
                </thead>
                <tbody id="zone-list1">

                </tbody>
            </table>
        </div>

        <!-- Item Reporting Form -->
    </section>

    <!-- Supplier Portal Section -->
    <section id="supplier-portal" style="display: none;">
        <h2>Item-category</h2>
        <!-- Item List -->
        {% include 'category.html' %}

    </section>

    <script>
        // Function to switch between sections
        function showSection(sectionId) {
            loadvolunteerhead();
            document.getElementById('admin-dashboard').style.display = 'none';
            document.getElementById('volunteer-interface').style.display = 'none';
            document.getElementById('supplier-portal').style.display = 'none';

            document.getElementById(sectionId).style.display = 'block';
        }


    </script>
    <script>
        function sendRequest(data, successCallback, errorCallback) {
            const url = `/superadmin/`;
            const csrfToken = document.querySelector('[name=csrfmiddlewaretoken]').value;

            const options = {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'X-CSRFToken': csrfToken,
                    'X-Requested-With': 'XMLHttpRequest'
                },
                body: JSON.stringify(data)
            };

            fetch(url, options)
                .then(response => {
                    if (response.ok) {
                        return response.json();
                    } else {
                        throw new Error('Network response was not ok.');
                    }
                })
                .then(data => {
                    successCallback(data); // Call the success callback with the response data
                })
                .catch(error => {
                    errorCallback(error); // Call the error callback if there is an issue
                });
        }




        window.onload = function () {
            fetchvolunteer_headUpdates();
            zonedata();
            Categorysdata();
        };



        function fetchvolunteer_headUpdates() {
            debugger
            const data = {
                'mode': '3' // Example additional parameter
            };

            sendRequest(
                data,           // Data to send
                function (data) { // Success callback

                    const tableBody = document.querySelector('#table_body tbody');
                    debugger
                    tableBody.innerHTML = ''; // Clear the table

                    data.volunteerHead_data.forEach(volunteerHead_data1 => {
                        const newRow = document.createElement('tr');
                        newRow.id = `volunteerHeadRow_${volunteerHead_data1.id}`;
                        newRow.innerHTML = `
                               <td></td> <!-- Auto-increment index -->
                               <td>
                                   <span class="name-display" id="volunteerHead_Name_${volunteerHead_data1.id}">${volunteerHead_data1.name}</span>
                                   <input type="text" id="nameInput_${volunteerHead_data1.id}" class="name-input" style="display:none;" value="${volunteerHead_data1.name}">
                               </td>
                               <td>
                                   <span class="email-display" id="volunteerHead_Email_${volunteerHead_data1.id}">${volunteerHead_data1.email}</span>
                                   <input type="email" id="emailInput_${volunteerHead_data1.id}" class="email-input" style="display:none;" value="${volunteerHead_data1.email}">
                               </td>
                               <td>
                                   <span class="phone-display" id="volunteerHead_Phone_${volunteerHead_data1.id}">${volunteerHead_data1.phone}</span>
                                   <input type="text" id="phoneInput_${volunteerHead_data1.id}" class="phone-input" style="display:none;" value="${volunteerHead_data1.phone}">
                               </td>
                               <td>
                                   <button id="editButton_${volunteerHead_data1.id}" onclick="toggleEditMode('${volunteerHead_data1.id}')">Edit</button>
                                   <button id="submitButton_${volunteerHead_data1.id}" style="display:none;" onclick="submitEdit('${volunteerHead_data1.id}')">Submit</button>
                                   <button id="deleteButton_${volunteerHead_data1.id}" onclick="deleteVolunteerHead('${volunteerHead_data1.id}')">Delete</button>
                               </td>
                               <td>
                                   <button id="emailButton_${volunteerHead_data1.id}" onclick="emailVolunteerHead('${volunteerHead_data1.id}')">Send</button>
                               </td>
                                     `;
                        tableBody.appendChild(newRow);
                        updateRowNumbers();

                    });
                },
                function (error) { // Error callback
                    console.error('Error fetching product updates:', error);
                }
            );
        }
        function updateRowNumbers() {
            const rows = document.querySelectorAll('#table_body1 tr');
            rows.forEach((row, index) => {
                // Update the .No cell in each row (1-based index)
                row.children[0].textContent = index + 1;
            });
        }


        function loadvolunteerhead() {

            const select = document.getElementById('volunteer-head3');
            const data = { 'mode': '3' };

            sendRequest(
                data,
                function (data) {

                    select.innerHTML = '<option value="">Select a volunteerHead</option>';
                    data.volunteerHead_data.forEach(camp => {
                        const option = document.createElement('option');
                        option.value = camp.id;
                        option.textContent = camp.name;
                        select.appendChild(option);
                    });
                },
                function (error) {
                    console.error('Error fetching camp data:', error);
                }

            );
        }




        function Add_volunteer_head() {
            const volunteer_head_Name = document.getElementById('volunteer-head Name').value;
            const volunteer_head_Email = document.getElementById('volunteer-head Email').value;
            const volunteer_head_phone = document.getElementById('volunteer-head phone').value;


            const data = {
                'volunteer_head_Name': volunteer_head_Name,
                'volunteer_head_Email': volunteer_head_Email,
                'volunteer_head_phone': volunteer_head_phone,

                'mode': "2"
            };

            sendRequest(
                data,           // Data to send
                function (data) {
                    debugger
                    // Success callback
                    if (data.status === 'success') {
                        showAlert("Volunteer_head added successfully", 'alert-success'); // Or display a success notification
                        fetchvolunteer_headUpdates();
                    } else {
                        showAlert("Volunteer_head email already exists!", 'alert-warning'); // Or display an error notification
                    }
                    // Refresh product list
                },
                function (error) { // Error callback
                    showAlert("Volunteer_head not added", 'alert-error');
                    console.error('Error adding item:', error);
                }
            );
        }


        function deleteVolunteerHead(volunteerHead_data1_id) {
            const data = {
                'volunteerHead_data1_id': volunteerHead_data1_id,
                'mode': "4"
            };

            // Confirm deletion
            if (confirm('Are you sure you want to delete this item?')) {
                sendRequest(
                    data,
                    function (response) {
                        if (response.success) {
                            // Success callback: Remove the row from the table
                            showAlert("volunteerHead deleted successfully", 'alert-success');
                            const row = document.getElementById('volunteerHeadRow_' + volunteerHead_data1_id);
                            row.parentNode.removeChild(row);
                        }
                        else {
                            // If the deletion failed, show the error message
                            showAlert(response.message, 'alert-error');
                        }
                    },
                    function (error) {
                        // Error callback
                        console.error('There was a problem with the fetch operation:', error);
                    }
                );
            }
        }



        function emailVolunteerHead(volunteerHead_data1_id) {
            const data = {
                'volunteerHead_data1_id': volunteerHead_data1_id,
                'mode': "5"
            };

            // Confirm deletion
            if (confirm('Are you sure you want to send email?')) {
                sendRequest(
                    data,
                    function (response) {
                        // Success callback: Remove the row from the table
                        showAlert("Registration email sent successfully.", 'alert-success');
                    },
                    function (error) {
                        // Error callback
                        showAlert("Registration email sent problem.", 'alert-error');
                    }

                );
                showAlert("Registration email senting wait....", 'alert-success');
            }
        }



        function submitEdit(volunteerHeadId) {

            const nameInput = document.getElementById('nameInput_' + volunteerHeadId).value;
            const emailInput = document.getElementById('emailInput_' + volunteerHeadId).value;
            const phoneInput = document.getElementById('phoneInput_' + volunteerHeadId).value;

            const data = {
                'name': nameInput,
                'email': emailInput,
                'phone': phoneInput,
                'volunteerHead_id': volunteerHeadId,
                'mode': "1"
            };

            sendRequest(
                data,           // Data to send
                function (data) { // Success callback
                    debugger
                    showAlert("VolunteerHead updated successfully", 'alert-success');
                    document.getElementById('volunteerHead_Name_' + volunteerHeadId).textContent = data.name;
                    document.getElementById('volunteerHead_Email_' + volunteerHeadId).textContent = data.email;
                    document.getElementById('volunteerHead_Phone_' + volunteerHeadId).textContent = data.phone;
                    toggleEditMode(volunteerHeadId); // Toggle edit mode off
                },
                function (error) { // Error callback
                    showAlert("VolunteerHead not updated", 'alert-error');
                    console.error('Error updating item:', error);
                }
            );
        }


        function toggleEditMode(rowId) {
            const nameDisplay = document.getElementById('volunteerHead_Name_' + rowId)
            const nameInput = document.getElementById('nameInput_' + rowId);

            const emailDisplay = document.getElementById('volunteerHead_Email_' + rowId)
            const emailInput = document.getElementById('emailInput_' + rowId);

            const phoneDisplay = document.getElementById('volunteerHead_Phone_' + rowId)
            const phoneInput = document.getElementById('phoneInput_' + rowId);

            const editButton = document.getElementById('editButton_' + rowId);
            const submitButton = document.getElementById('submitButton_' + rowId);

            // Check if the inputs are already displayed
            if (nameDisplay.style.display === 'none') {
                // Switch to display mode
                nameDisplay.style.display = 'inline';
                nameInput.style.display = 'none';
                emailDisplay.style.display = 'inline';
                emailInput.style.display = 'none';
                phoneDisplay.style.display = 'inline';
                phoneInput.style.display = 'none';

                editButton.style.display = 'inline';
                submitButton.style.display = 'none';
            } else {
                // Switch to edit mode
                nameDisplay.style.display = 'none';
                nameInput.style.display = 'inline';
                emailDisplay.style.display = 'none';
                emailInput.style.display = 'inline';
                phoneDisplay.style.display = 'none';
                phoneInput.style.display = 'inline';

                editButton.style.display = 'none';
                submitButton.style.display = 'inline';
            }
        }
    </script>
    <script>

        function sendRequest1(data, successCallback, errorCallback) {
            const url = `/zonemanage/`;
            const csrfToken = document.querySelector('[name=csrfmiddlewaretoken]').value;

            const options = {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'X-CSRFToken': csrfToken,
                    'X-Requested-With': 'XMLHttpRequest'
                },
                body: JSON.stringify(data)
            };

            fetch(url, options)
                .then(response => {
                    if (response.ok) {
                        return response.json();
                    } else {
                        throw new Error('Network response was not ok.');
                    }
                })
                .then(data => {
                    successCallback(data); // Call the success callback with the response data
                })
                .catch(error => {
                    errorCallback(error); // Call the error callback if there is an issue
                });
        }


        // window.onload = function () {

        // };



        function zonedata() {
            debugger;
            const data = {
                'mode': '3' // Example additional parameter
            };

            sendRequest1(
                data, // Data to send
                function (data) { // Success callback
                    const tableBody = document.querySelector('#zone-list tbody');
                    debugger;
                    tableBody.innerHTML = ''; // Clear the table

                    // Iterate through the zones data and populate the table
                    data.zones.forEach((zone, index) => {
                        const newRow = document.createElement('tr');
                        newRow.id = `zoneRow_${zone.id}`;
                        newRow.innerHTML = `
                    <td>${index + 1}</td> <!-- Auto-increment index -->
                    <td>
                        <span class="zone-name-display" id="zone-name_${zone.id}">${zone.name}</span>
                    </td>
                    <td>
                        <span class="zone-description-display" id="zone-description_${zone.id}">${zone.description}</span>
                    </td>
                    <td>
                        <span class="volunteer-head-name-display" id="volunteer-head-name_${zone.id}">
                            ${zone.volunteer_head ? zone.volunteer_head.name : 'N/A'}
                        </span>
                    </td>
                    <td>
                        <button id="deleteButton_${zone.id}" onclick="deleteZone('${zone.id}')">Delete</button>
                    </td>
                `;
                        tableBody.appendChild(newRow);
                    });


                },
                function (error) { // Error callback
                    console.error('Error fetching zone data:', error);
                }
            );
        }







        function Add_zone() {
            const zone_name = document.getElementById('zone-name').value;
            const zone_description = document.getElementById('zone-description').value;
            const volunteer_head_id = document.getElementById('volunteer-head3').value;


            const data = {
                'zone_name': zone_name,
                'zone_description': zone_description,
                'volunteer_head_id': volunteer_head_id,

                'mode': "2"
            };

            sendRequest1(
                data,           // Data to send
                function (data) {
                    debugger
                    // Success callback
                    if (data.status === 'success') {
                        showAlert("zone added successfully", 'alert-success'); // Or display a success notification
                        zonedata();
                    }
                    // Refresh product list
                },
                function (error) { // Error callback
                    showAlert("zone not added", 'alert-error');
                    console.error('Error adding item:', error);
                }
            );
        }


        function deleteZone(zoneid) {
            const data = {
                'zoneid': zoneid,
                'mode': "4"
            };

            // Confirm deletion
            if (confirm('Are you sure you want to delete this item?')) {
                sendRequest1(
                    data,
                    function (response) {
                        // Success callback: Remove the row from the table
                        showAlert("zone deleted successfully", 'alert-success');
                        const row = document.getElementById('zoneRow_' + zoneid);
                        row.parentNode.removeChild(row);
                    },
                    function (error) {
                        // Error callback
                        showAlert("zone not deleted", 'alert-error');
                    }
                );
            }
        }





    </script>

</body>

</html>